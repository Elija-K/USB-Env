<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USB Stick Register</title>
    <link rel="stylesheet" href="default.css">
</head>
<body>
    <h1>Anmeldung deines USB Sticks</h1>
    <h3 id="posserialnum">Mögliche Seriennummer: Serial Number</h3>
    <p>Was ist die Seriennummer deines USB-Sticks? (Bei einem gekauften USB-Stick auf der Datei serial.txt)</p>
    <input type="text" placeholder="Seriennummer" id="serialnum">
    <p>Dein Name? (Damit wir einen privaten Schlüssel für dich machen können)</p>
    <input type="text" id="name">
    <p>Wenn du Fertig bist kannst du auf Abschicken klicken</p>
    <button onclick="submit()">Abschicken</button>
</body>
</html>
<script>
    let url = document.URL;
    let urlarray = url.split("?");
    let serialnumber = urlarray[1];
    document.getElementById("posserialnum").innerHTML = "Mögliche Seriennummer: " + serialnumber;

    function submit() {
        serial = document.getElementById("serialnum").value;
        name = document.getElementById("name").value;
        data = serial + name
        console.log("Serial: " + serial);
        console.log("Name: " + name);
        console.log("Data for Chksm: " + data);
        // Checksum
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                console.log("Request: " + xhttp.responseText);
                window.checksumraw = xhttp.responseText;
            }
        };
    let geturl = "https://api.hashify.net/hash/md5/hex?value=" + data;
    xhttp.open("GET", geturl, true);
    xhttp.send();
    setTimeout(() => {
        let checksumjson =  JSON.parse(window.checksumraw);
        let checksum = checksumjson["Digest"];
        console.log("Checksum: " + checksum);
        let gotourl = "http://127.0.0.1:5000/?" + checksum + "?" + name + "?" + serial;
        console.log("Redirect URL: " + gotourl);
        window.location.href = gotourl;
    }, 1000);
    }
</script>